{"hash":"69c0472a8ba0453388470c19f241c3f399c8311e","data":{"post":{"title":"Entity Framework quick start","path":"/entity-framework-quick-start/","date":"13. September 2011","timeToRead":3,"tags":[{"id":".Net","title":".Net","path":"/tag/.Net/"}],"description":"Microsoft’s Entity Framework has been around a while, but with it’s latest incarnation it is really shaping up nicely. I’ve been enjoying the ‘code first’ approach in version 4.1 of the framework. This allows you start your application design from POCOs, allowing the framework to infer the database design for you.","content":"<p>Microsoft’s Entity Framework has been around a while, but with it’s latest incarnation it is really shaping up nicely. I’ve been enjoying the ‘code first’ approach in version 4.1 of the framework. This allows you start your application design from POCOs, allowing the framework to infer the database design for you. For example, take the following Member entity model:</p>\n<pre class=\"language-text\"><code class=\"language-text\">class Member\n{\n    public int Id { get; set; }\n    public string FirstName { get; set; }\n    public string LastName { get; set; }\n}</code></pre>\n<p>The following class derives from the DbContext base class, and exposes our Member model:</p>\n<pre class=\"language-text\"><code class=\"language-text\">class EFDbContext : DbContext\n{\n    public DbSet&lt;Member&gt; Members { get; set; }\n\n    public EFDbContext()\n    {\n        Database.SetInitializer&lt;EFDbContext&gt;(new DbContextInitializer());\n    }\n}</code></pre>\n<p>Note the <strong>SetInitializer</strong> call in the constructor. This allows us to seed the database with some data, using the following class:</p>\n<pre class=\"language-text\"><code class=\"language-text\">class DbContextInitializer : DropCreateDatabaseIfModelChanges&lt;EFDbContext&gt;\n{\n    protected override void Seed(EFDbContext Context)\n    {\n        new List&lt;Member&gt;\n        {\n            new Member {\n                FirstName = &quot;Andrew&quot;,\n                LastName = &quot;Rowland&quot;\n            },\n            new Member {\n                FirstName = &quot;Roland&quot;,\n                LastName = &quot;Browning&quot;\n            },\n        }.ForEach(m =&gt; Context.Members.Add(m));\n        \n        base.Seed(Context);\n    }\n}</code></pre>\n<p>Now we need a simple repository class, so we can query the database:</p>\n<pre class=\"language-text\"><code class=\"language-text\">class MemberRepository\n{\n    private EFDbContext Context = new EFDbContext();\n\n    public IQueryable&lt;Member&gt; Members\n    {\n        get { return Context.Members; }\n    }\n}</code></pre>\n<p>Standard practice is to use an interface, and obtain this concrete class using an IOC container, but it will do for demonstration purposes.</p>\n<p>Due to lazy loading, nothing would happen until we actually run a query. So finally, a console application to instantiate the repository, and display the data:</p>\n<pre class=\"language-text\"><code class=\"language-text\">class ConsoleApplication\n{\n    static void Main(string[] args)\n    {\n        MemberRepository Repository = new MemberRepository();\n\n        Repository.Members.ToList().ForEach(m =&gt; Console.WriteLine(String.Format(&quot;Member: {0} {1}&quot;, m.FirstName, m.LastName)));\n\n        Console.ReadKey();\n    }\n}</code></pre>\n<p>We can place all of the code into one console application. Install EF4.1, create a console application in Visual Studio 2010, paste in the class below. You may have to set the startup object in the project properties.</p>\n<pre class=\"language-text\"><code class=\"language-text\">using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing System.Data.Entity;\n\nnamespace EFExample\n{\n    class Member\n    {\n        public int Id { get; set; }\n        public string FirstName { get; set; }\n        public string LastName { get; set; }\n    }\n\n    class EFDbContext : DbContext\n    {\n        public DbSet&lt;Member&gt; Members { get; set; }\n\n        public EFDbContext()\n        {\n            Database.SetInitializer&lt;EFDbContext&gt;(new DbContextInitializer());\n        }\n    }\n\n    class DbContextInitializer : DropCreateDatabaseIfModelChanges&lt;EFDbContext&gt;\n    {\n        protected override void Seed(EFDbContext Context)\n        {\n            new List&lt;Member&gt;\n            {\n                new Member {\n                    FirstName = &quot;Andrew&quot;,\n                    LastName = &quot;Rowland&quot;\n                },\n                new Member {\n                    FirstName = &quot;Roland&quot;,\n                    LastName = &quot;Browning&quot;\n                },\n            }.ForEach(m =&gt; Context.Members.Add(m));\n            \n            base.Seed(Context);\n        }\n    }\n\n    class MemberRepository\n    {\n        private EFDbContext Context = new EFDbContext();\n\n        public IQueryable&lt;Member&gt; Members\n        {\n            get { return Context.Members; }\n        }\n    }\n\n    class ConsoleApplication\n    {\n        static void Main(string[] args)\n        {\n            MemberRepository Repository = new MemberRepository();\n\n            Repository.Members.ToList().ForEach(m =&gt; Console.WriteLine(String.Format(&quot;Member: {0} {1}&quot;, m.FirstName, m.LastName)));\n\n            Console.ReadKey();\n        }\n    }\n}</code></pre>\n<p>Run the application, and the magic begins. If you have an instance of SQL Server Express running, a database with a single Members table will be created, populated with data, and the results displayed.</p>\n<p>Bit of a quick post this one, so feel free to ask a question. I’m not certain I’ve added enough detail.</p>\n","cover_image":null}},"context":{}}