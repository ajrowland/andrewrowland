{"hash":"29c8696ef7044eb35a5645ab27c0306b691b5868","data":{"post":{"title":"Using the Zend framework Lucene library","path":"/using-the-zend-framework-lucene-library/","date":"23. May 2008","timeToRead":6,"tags":[{"id":"CodeIgniter","title":"CodeIgniter","path":"/tag/CodeIgniter/"},{"id":"PHP","title":"PHP","path":"/tag/PHP/"}],"description":"I know, only a few articles in, so I don't really need a site search function. But you never know, I might actually keep writing (even if no-one is reading) and so I've been looking around for some solutions.","content":"<p>I know, only a few articles in, so I don't really need a site search function. But you never know, I might actually keep writing (even if no-one is reading) and so I've been looking around for some solutions.</p>\n<p>I've looked at a few, for example: <a href=\"http://www.swish-e.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Swish-e</a>, and <a href=\"http://www.sphider.eu/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Sphider</a>. Nothing really float my boat, until I had a look at the Zend Framework. It's another MVC based PHP framework, though it looks a little heavier than CodeIgniter. The documentation is not as good either, but it did have a Lucene library.</p>\n<p>I found a way of incorporating a Zend framework class as a CodeIgniter library here by Fred Wu. Nice work Fred, thanks.</p>\n<p>As Fred suggests, copy the Zend folder from the framework library to application/libraries/ in your CodeIgniter installation. I discovered that I only needed the Zend/Search folder, and the Zend/Exception.php file.</p>\n<p>Continuing Fred's instructions, create a Zend.php library file with the code posted on his blog page. Now we can get started.</p>\n<p>Create a directory for the index. In my example code I created a directory called application/search. Now we can create a controller called search.php that will contain some simple create, and search methods:</p>\n<pre class=\"language-text\"><code class=\"language-text\">&lt;?php\nclass Search extends MY_Controller {\n\n    function Search()\n    {\n        parent::MY_Controller();\n\n        $this-&gt;load-&gt;library(&#39;zend&#39;);\n        $this-&gt;zend-&gt;load(&#39;Zend/Search/Lucene&#39;);\n    }\n\n    function create()\n    {\n        // This method should be authenticated, or removed once the index is created.\n        // TODO: Some sort of site spidering process to add the entire site to the index.\n\n        $index = Zend_Search_Lucene::create(APPPATH . &#39;search/index&#39;);\n\n            $doc = Zend_Search_Lucene_Document_Html::loadHTMLFile(&#39;http://www.andrewrowland.com&#39;);\n\n            $index-&gt;addDocument($doc);\n\n        echo &#39;&lt;p&gt;Index created&lt;/p&gt;&#39;;\n    }\n\n    function index()\n    {\n        // TODO: Create an index method that contains a search form.\n    }\n\n    function result()\n    {\n        // Hardcoded search result example.\n        // TODO: Take a user search query, and expand the result summary\n\n        $index = Zend_Search_Lucene::open(APPPATH . &#39;search/index&#39;);\n\n        $data[&#39;results&#39;] = $index-&gt;find(&#39;andrew&#39;);\n\n        $this-&gt;load-&gt;view(&#39;search_result_view&#39;, $data);\n    }\n}\n?&gt;</code></pre>\n<p>I didn't bother with the create index view, as all that is needed is a simple message explaining that the index is created. The search_result_view.php view will display the results:</p>\n<pre class=\"language-text\"><code class=\"language-text\">&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Search example&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n&lt;ul&gt;\n    &lt;?php foreach($results as $result):?&gt;\n    &lt;li&gt;&lt;?php echo $result-&gt;title;?&gt;&lt;/li&gt;\n    &lt;?php endforeach;?&gt;\n&lt;/ul&gt;\n\n&lt;/body&gt;\n&lt;/html&gt;</code></pre>\n<p>As you can see, I've noted a few TODO's. Might add a bit of jQuery action (because I'm worth it) in there to. Weekend coming up, so I'll expand on this next week.</p>\n<h2 id=\"13-thoughts-on-using-the-zend-framework-lucene-library\"><a href=\"#13-thoughts-on-using-the-zend-framework-lucene-library\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>13 thoughts on “Using the Zend framework Lucene library”</h2>\n<h3 id=\"alex\"><a href=\"#alex\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>alex</h3>\n<p><em>May 17, 2009 at 2:36 pm</em></p>\n<p>what do i have to wrote in the code where it is the comment “ro do”?</p>\n<hr>\n<h3 id=\"andy\"><a href=\"#andy\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Andy</h3>\n<p><em>May 17, 2009 at 3:07 pm</em></p>\n<p>The index method doesn’t have to do much really, apart from load the view for this method.</p>\n<p>The view will consist of a form to post your search term. This will post to your result method, which is currently hardcoded with the term ‘Andrew’. You would change this to take the value from the form field.</p>\n<p>Clear? If not, I’ll amend the example.</p>\n<hr>\n<h3 id=\"suresh\"><a href=\"#suresh\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Suresh</h3>\n<p><em>June 30, 2009 at 11:48 am</em></p>\n<p>Hi Andy,</p>\n<p>Could you please post the content for Zend.php library file( CI ). As the link to Fred Wu site is down.</p>\n<p>Thanks for coming up with this search article.</p>\n<hr>\n<h3 id=\"andy-1\"><a href=\"#andy-1\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Andy</h3>\n<p><em>June 30, 2009 at 11:56 am</em></p>\n<p>No problem, you can obtain it here. I don’t know if he ever altered it, but this is the version of the code I use on my site.</p>\n<hr>\n<h3 id=\"peter\"><a href=\"#peter\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Peter</h3>\n<p><em>August 7, 2009 at 6:28 pm</em></p>\n<p>Hi,</p>\n<p>I followed your instruction and got Lucene for Zend to work in Code Igniter on my home server. Unfortunately after i copied it over to the hosted staging server i get these errors whenever i try to execute any Lucene methods:</p>\n<pre class=\"language-text\"><code class=\"language-text\">A PHP Error was encountered\nSeverity: Notice\nMessage: Hex number is too big: 0x100000000\nFilename: Storage/File.php\nLine Number: 268</code></pre>\n<p>Do you have any idea what could be wrong?</p>\n<p>Thanks</p>\n<p>Peter</p>\n<hr>\n<h3 id=\"asif\"><a href=\"#asif\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Asif</h3>\n<p><em>August 7, 2009 at 6:30 pm</em></p>\n<p>will it crawl the whole domain going through each link and create the search content?</p>\n<p>if that is the case then how can i generate the url link with the search keyword in the search result display?</p>\n<hr>\n<h3 id=\"andy-2\"><a href=\"#andy-2\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Andy</h3>\n<p><em>August 7, 2009 at 6:47 pm</em></p>\n<p>This example is just a test case that indexes the home page of my site. A more complete example can be found in the next part of this article.</p>\n<hr>\n<h3 id=\"nir-gavish\"><a href=\"#nir-gavish\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Nir Gavish</h3>\n<p><em>September 13, 2009 at 2:29 am</em></p>\n<p>i’ve seen much talk about using lucene as an indexer, but what about using it as the sole data repository? anyone ever try it? how did it preform? how reliable was it? thanks</p>\n<hr>\n<h3 id=\"junaid\"><a href=\"#junaid\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>junaid</h3>\n<p><em>April 10, 2010 at 4:12 am</em></p>\n<p>Hi,\na month ago i sent you comments regarding your article about integration of zend lucene with CI. I have got out of the errors as i reported to you before. but got into some new ones. Now i want to search html docs in my application…every query i m submitting in search is returning no results..when there actually are. i am sending you the code..plz if you can have a look at it and point out my mistake.</p>\n<p>Controller</p>\n<pre class=\"language-text\"><code class=\"language-text\">&lt;?php\nclass Search extends Controller {\n    function Search()\n    {\n        parent::Controller();\n\n        $this-&gt;load-&gt;library(‘zend’);\n        $this-&gt;zend-&gt;load(‘Zend/Search/Lucene’);\n        $this-&gt;search_index = APPPATH . ‘search/index’;\n    }\n\n    function create()\n    {\n        Zend_Search_Lucene::create($this-&gt;search_index);\n        $doc = Zend_Search_Lucene_Document_Html::loadHTMLFile(’http://localhost/codeigniter/index.php/universities/home’);\n        $doc-&gt;addField(Zend_Search_Lucene_Field::UnIndexed(‘url’, ‘http://localhost/codeigniter/index.php/universities/home’));\n\n        $index-&gt;addDocument($doc);\n        $index-&gt;commit();\n\n        $index-&gt;optimize();\n    }\n\n    function optimize()\n    {\n        $this-&gt;login();\n\n        $index = Zend_Search_Lucene::open($this-&gt;search_index);\n        $index-&gt;optimize();\n\n        echo ‘\n\n        Index optimized.\n\n        ‘;\n    }\n\n    function result()\n    {\n        // Create empty array, in case there are no results.\n        $data[‘results’] = array();\n\n        // If a search_query parameter has been posted, search the index.\n        if ($this-&gt;input-&gt;post(‘search_query’))\n\n        {\n            $index = Zend_Search_Lucene::open($this-&gt;search_index);\n            $data[‘results’] = $index-&gt;find($this-&gt;input-&gt;post(‘search_query’));\n        }\n        // Load view, and populate with results.\n        $this-&gt;load-&gt;view(‘search/search_result’, $data);\n    }\n}\n?&gt;</code></pre>\n<p>and at search_result view i get every time “No results were returned for query: a”.</p>\n<p>can u figure aut my mistake plz.</p>\n<hr>\n<h3 id=\"jesmar\"><a href=\"#jesmar\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Jesmar</h3>\n<p><em>February 8, 2011 at 10:28 am</em></p>\n<p>HELLO..i have a problem in my ordering system…I have an error on my controller…Fatal error: <code class=\"language-text\">Call to a member function result() on a non-object in C:xampphtdocscifofb1projectsystemapplicationcontrollerscuser.php on line 210</code>…pls help me</p>\n<hr>\n<h3 id=\"noor\"><a href=\"#noor\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Noor</h3>\n<p><em>January 8, 2015 at 7:27 am</em></p>\n<p>I downloaded the latest Zend framework release ‘ZendFramework-2.3.3.zip’ form site <a href=\"http://framework.zend.com/downloads\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://framework.zend.com/downloads</a>, but I did not find the folder “Search” in path “Zend/Search/Lucene” !! from where I can get it?</p>\n<hr>\n<h3 id=\"noor-1\"><a href=\"#noor-1\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Noor</h3>\n<p><em>January 8, 2015 at 8:18 am</em></p>\n<p>Ok, I discover the problem, zf2 put zendSearch as an optional library, so I have to download it alone</p>\n<hr>\n<h3 id=\"noor-2\"><a href=\"#noor-2\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Noor</h3>\n<p><em>January 8, 2015 at 11:08 am</em></p>\n<p>following your steps, the search works for the previous version of zf1., but right now I want to work with zf2.\nI put the folder ZendSearch under librariy/zend, and I have chnaged the links to look like this:</p>\n<pre class=\"language-text\"><code class=\"language-text\">$this-&gt;load-&gt;library(‘zend’);\n$this-&gt;zend-&gt;load(‘Zend/ZendSearch/Lucene/Lucene’);</code></pre>\n<p>But unfortunately nothing works ?? what is wrong ?</p>\n<hr>\n","cover_image":null}},"context":{}}