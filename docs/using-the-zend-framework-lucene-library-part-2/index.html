<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Using the Zend framework Lucene library Part 2 - Andrew Rowland</title><meta name="gridsome:hash" content="b440d2dfedc5f7355f69b42f14a3a17b5add6387"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.12"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="description" name="description" content="I only want to help you"><meta data-vue-tag="ssr" name="description" content="Note: Since this article was written I’ve moved to WordPress, and have not implemented the example code listed below.
In a previous article I talked about using a library from the Zend framework to create a site search. As you try out this functionality using the search box, above right."><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.9bb7ffafafc09ac851d81afb65b8ef59.png"><link rel="preload" href="/assets/css/0.styles.11ed0a24.css" as="style"><link rel="preload" href="/assets/js/app.261c0a70.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--post-vue.8ad119a0.js" as="script"><link rel="prefetch" href="/assets/js/page--src--pages--404-vue.3dc0d434.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.279a9bb8.js"><link rel="prefetch" href="/assets/js/page--src--templates--redirect-vue.91df8a62.js"><link rel="prefetch" href="/assets/js/page--src--templates--tag-vue.e41997c1.js"><link rel="stylesheet" href="/assets/css/0.styles.11ed0a24.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <script>
      // Add dark / light detection that runs before Vue.js load. Borrowed from overreacted.io
      (function() {
        window.__onThemeChange = function() {};
        function setTheme(newTheme) {
          window.__theme = newTheme;
          preferredTheme = newTheme;
          document.body.setAttribute('data-theme', newTheme);
          window.__onThemeChange(newTheme);
        }

        var preferredTheme;
        try {
          preferredTheme = localStorage.getItem('theme');
        } catch (err) { }

        window.__setPreferredTheme = function(newTheme) {
          setTheme(newTheme);
          try {
            localStorage.setItem('theme', newTheme);
          } catch (err) {}
        }

        var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');
        darkQuery.addListener(function(e) {
          window.__setPreferredTheme(e.matches ? 'dark' : 'light')
        });

        setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
      })();
    </script>

    <div id="app" data-server-rendered="true"><header class="header"><div class="header__left"><a href="/" class="logo active"><span class="logo__text">
    ← Andrew Rowland
  </span></a></div><div class="header__right"><button role="button" aria-label="Toggle dark/light" class="toggle-theme"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></button></div></header><main class="main"><div class="post-title"><h1 class="post-title__text">
      Using the Zend framework Lucene library Part 2
    </h1><div class="post-meta">
   Posted 4. July 2008.
   <strong>3 min read.</strong></div></div><div class="post content-box"><div class="post__header"><!----></div><div class="post__content"><p><strong>Note</strong>: Since this article was written I’ve moved to WordPress, and have not implemented the example code listed below.</p>
<p>In a previous article I talked about using a library from the Zend framework to create a site search. As you try out this functionality using the search box, above right.</p>
<p>I never finished the article, so I'll explain here how I implemented this using CodeIgniter. I'll also detail how I built the 'quick results' tool (click in the search box).</p>
<p>Below is an example controller class that shows how I constructed the search index by pulling articles out of the database. My actual class calls security methods that require authentication before performing any of these methods. I left them out of the listing to keep it short and sweet. You will have to alter the code to allow for the difference in database schema, and to suit your intended available search criteria.</p>
<pre class="language-text"><code class="language-text">&lt;?php
class Search extends Controller {

    function Search()
    {
        parent::Controller();

        // Load Zend Lucene library.  See previous article.
        $this-&gt;load-&gt;library(&#39;zend&#39;);
        $this-&gt;zend-&gt;load( &#39;Zend/Search/Lucene&#39;);

        // Location of search index.  Used by all Search controller methods.
        $this-&gt;search_index = APPPATH . &#39;search/index&#39;;
    }

    function reindex()
    {
        // Create index.  Will delete any existing index.
        $index = Zend_Search_Lucene::create($this-&gt;search_index);

        // Obtain all articles.
        $query = $this-&gt;db-&gt;get(&#39;articles&#39;);

        // Loop through articles, adding an index for each one.		
        foreach ($query-&gt;result() as $article)
        {
            // Create Lucene document for this article.
            $doc = new Zend_Search_Lucene_Document();

            // Add required fields.
            $doc-&gt;addField(Zend_Search_Lucene_Field::Text(&#39;title&#39;, $article-&gt;title));
            $doc-&gt;addField(Zend_Search_Lucene_Field::Text(&#39;subtitle&#39;, $subtitle));
            $doc-&gt;addField(Zend_Search_Lucene_Field::Text(&#39;category&#39;, $category_list));
            $doc-&gt;addField(Zend_Search_Lucene_Field::Text(&#39;path&#39;, &#39;/article/display/&#39; . $article-&gt;path));
            $doc-&gt;addField(Zend_Search_Lucene_Field::UnStored(&#39;content&#39;, $article-&gt;summary . $article-&gt;text));

            // Add docuument to index.
            $index-&gt;addDocument($doc);

            echo &#39;Added &#39; . $item-&gt;title . &#39; to index.&lt;br /&gt;&#39;;
        }

        $index-&gt;optimize();
    }

    function optimize()
    {
        $index = Zend_Search_Lucene::open($this-&gt;search_index);
        $index-&gt;optimize();

        echo &#39;&lt;p&gt;Index optimized.&lt;/p&gt;&#39;;
    }
}</code></pre>
<p>To utilise the index a result method is required:</p>
<pre class="language-text"><code class="language-text">function result()
{
    // Create empty array, in case there are no results.
    $data[&#39;results&#39;] = array();

    // If a search_query parameter has been posted, search the index.
    if ($this-&gt;input-&gt;post(&#39;search_query&#39;))
    {
        $index = Zend_Search_Lucene::open($this-&gt;search_index);

        // Get results.
        $data[&#39;results&#39;] = $index-&gt;find($this-&gt;input-&gt;post(&#39;search_query&#39;));
    }

    // Load view, and populate with results.
    $this-&gt;load-&gt;view(&#39;search_result_view&#39;, $data);
}</code></pre>
<p>And, of course, a view is required to display the results:</p>
<pre class="language-text"><code class="language-text">&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Search results&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;		

&lt;h1&gt;Search results&lt;/h1&gt;

&lt;?php if (empty($_POST[&#39;search_query&#39;])):?&gt;
&lt;p&gt;No search query submitted.&lt;/p&gt;
&lt;?php else:?&gt;
    &lt;?php if (count($results)):?&gt;
&lt;p&gt;&lt;?php echo count($results) ?&gt; result(s) returned for query: &lt;?php echo $_POST[&#39;search_query&#39;];?&gt;&lt;/p&gt;
&lt;ul&gt;
    &lt;?php foreach($results as $result):?&gt;
    &lt;li&gt;&lt;?=anchor(site_url($result-&gt;path), $result-&gt;title);?&gt; (&lt;?php echo round($result-&gt;score, 2) * 100;?&gt;%)&lt;/li&gt;
    &lt;?php endforeach;?&gt;
&lt;/ul&gt;
    &lt;?php else:?&gt;
&lt;p&gt;No results were returned for query: &lt;?php echo $_POST[&#39;search_query&#39;];?&gt;&lt;/p&gt;
    &lt;?php endif;?&gt;
&lt;?php endif;?&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div><div class="post__footer"><div class="post-tags"><a href="/tag/CodeIgniter/" class="post-tags__link"><span>#</span> CodeIgniter
		</a><a href="/tag/PHP/" class="post-tags__link"><span>#</span> PHP
		</a></div></div></div><div class="post-comments"></div><div class="author post-author"><img alt="Author image" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 180 180' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-79abe12977319e63670ceacd51dd8a4b'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='5'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-79abe12977319e63670ceacd51dd8a4b)' width='180' height='180' xlink:href='data:image/png%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCABAAEADASIAAhEBAxEB/8QAGwAAAgMBAQEAAAAAAAAAAAAABgcDBAUCAAj/xAA2EAACAQMCBAUCBAMJAAAAAAABAgMABBEFEgYhMUETFCJRYYGRMkJxsRUjQwckUlOSocHh8P/EABoBAAIDAQEAAAAAAAAAAAAAAAMEAgUGAQD/xAAiEQACAgIDAAMAAwAAAAAAAAABAgADBBESITETMkFRUmH/2gAMAwEAAhEDEQA/AK0Gpp3NaMGpxcvWKR68V3I6Qp/qNSpxbddoo/uavzwP7ALYB%2bR8w6pD3kFXodVg/wAYpDWPEep3MgWKKIfJzyogtLe8uWDXVxOT7KxVR9BSeRdVV6Y9jVtd9Vjmi1iAf1BVuPWbYdZBSgNtd2mXinmIx%2bFiSP8AesDUtf1mylCtJHsb8LbP%2b%2btQpau/6mEuU0dsvU%2bh01q2/wAwVMuvWg/qCvmccUay6H%2b8IueWQnSoBrusH8Wo3GfYAUU4v%2bwIyk/rBKKEsnpjYnufDNTrbkc/V9gKopMXX8bL7hTit7gSxsrniexj1CHxoHYqUfmuSDgkVNrAiltb1EUTkwXfsJ%2bDbBXXcycyM02dC0qIwjCBnIoJ/ggs%2bJzbWlzLbWpIYQx4KOh5cs9OnaiTUJNZEiraDytui8goyzcuWc1mb7BY/In2X9G604gTensU2srQ4YdsUvOPrCNdLmfZtKMrAgc%2buDWrqvE/EECmOOO0kgEiQtO6sHBI9RA6EDkP1oY1u%2b1K70uSC6hQO7D%2bbk8hnJPM47UfDYrapncluVTAwQTwWwi5L%2bzEZ/erHlpw%2bFs5Xj6DPpyf1zUwRlRWDAY6kSxjNeW%2b3QSALNKg6%2bE4Uj26jn9K1Psz2tezDjt4nw0YAI7bQR96ns7g2s8UsLL40TB1b5FCFlqTxPi43PH3OeYol0K5OoNMI7Vo4EGQ5Oct7UuuTTYP4kSjodiMnRtcudZ16zlvIoIp1UACEnaBnPPPemv56J7X1Ebscl6/ekrpkvlLvzcrB2ib%2bYoAHowOYpk6XMLiziEZVnUblBOdw%2bcfFZjLTi/XQl5hXc17Pc4vPBigm8zHJI7qGQgct3sR2FDP9oUlv/AUtlIUzsuWRc47mjDiK6tptOeKOwkgutuPFjnYqnzg0s9X1Q39wDbBPBjyqFsnce7f%2b9qYwKi1y78ELmWlaiP0wesNLVAQqM2fzFcCr1rowLEyTMqkcwMYNT%2bcnGAQucflWozqUgk27JmPydo%2b1an5UUdSgCExfaPw1dX6iSQeBD2Zhlj%2bgpkaTYxwaawRRE0C7ACM8uh5fQHPzU6afJGztEq7ipySG6fBB5dv2qNFaORAno3rtdeqnqcN8nlVGAF8k2JaSW8ckURmhZjOhO/aCwIJ5ZPatXh7WBYTvJtZ7V2ICJgNH7deo%2bKpRlUjaOEgq4AZtp6g5OfrgCqF1blpJH2oi4VmELkdu/vzHfpQ7EFg0Z2p2rbawm4s4kgm02ZLWO5FwQUI8NgFz3JpaXV1Laadb4O4lih5de/X61rh5JDcDxnV4xuYE8zyzn9qw%2bIIvN27ywJKu3JTxGyygdj2yftXqKxUdrGbLzaumE9BrLbQuNo6DHLFcX1%2b7gEy%2b4wTQ5FeBgBIeZ/MB/xXE1xzG71D4pv5eoKf/9k=' /%3e%3c/svg%3e" width="180" data-src="/assets/static/author.e6b6009.01fea4a6eb109fed65874b88d6ddc592.png" data-srcset="/assets/static/author.e6b6009.01fea4a6eb109fed65874b88d6ddc592.png 180w" data-sizes="(max-width: 180px) 100vw, 180px" class="author__image g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/author.e6b6009.01fea4a6eb109fed65874b88d6ddc592.png" class="author__image g-image g-image--loaded" width="180" alt="Author image"></noscript><!----><p class="author__intro">
		I only want to help you...
	</p><p class="author__links"><a href="//www.linkedin.com/in/hashbang/">LinkedIn</a><a href="//twitter.com/andyjrowland">Twitter</a><a href="//github.com/ajrowland">GitHub</a></p></div></main><footer class="footer"><span class="footer__copyright">Copyright © 2019. </span><span class="footer__links"></span></footer></div>
    <script>window.__INITIAL_STATE__={"data":{"post":{"title":"Using the Zend framework Lucene library Part 2","path":"\u002Fusing-the-zend-framework-lucene-library-part-2\u002F","date":"4. July 2008","timeToRead":3,"tags":[{"id":"CodeIgniter","title":"CodeIgniter","path":"\u002Ftag\u002FCodeIgniter\u002F"},{"id":"PHP","title":"PHP","path":"\u002Ftag\u002FPHP\u002F"}],"description":"Note: Since this article was written I’ve moved to WordPress, and have not implemented the example code listed below.\nIn a previous article I talked about using a library from the Zend framework to create a site search. As you try out this functionality using the search box, above right.","content":"\u003Cp\u003E\u003Cstrong\u003ENote\u003C\u002Fstrong\u003E: Since this article was written I’ve moved to WordPress, and have not implemented the example code listed below.\u003C\u002Fp\u003E\n\u003Cp\u003EIn a previous article I talked about using a library from the Zend framework to create a site search. As you try out this functionality using the search box, above right.\u003C\u002Fp\u003E\n\u003Cp\u003EI never finished the article, so I'll explain here how I implemented this using CodeIgniter. I'll also detail how I built the 'quick results' tool (click in the search box).\u003C\u002Fp\u003E\n\u003Cp\u003EBelow is an example controller class that shows how I constructed the search index by pulling articles out of the database. My actual class calls security methods that require authentication before performing any of these methods. I left them out of the listing to keep it short and sweet. You will have to alter the code to allow for the difference in database schema, and to suit your intended available search criteria.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003E&lt;?php\nclass Search extends Controller {\n\n    function Search()\n    {\n        parent::Controller();\n\n        \u002F\u002F Load Zend Lucene library.  See previous article.\n        $this-&gt;load-&gt;library(&#39;zend&#39;);\n        $this-&gt;zend-&gt;load( &#39;Zend\u002FSearch\u002FLucene&#39;);\n\n        \u002F\u002F Location of search index.  Used by all Search controller methods.\n        $this-&gt;search_index = APPPATH . &#39;search\u002Findex&#39;;\n    }\n\n    function reindex()\n    {\n        \u002F\u002F Create index.  Will delete any existing index.\n        $index = Zend_Search_Lucene::create($this-&gt;search_index);\n\n        \u002F\u002F Obtain all articles.\n        $query = $this-&gt;db-&gt;get(&#39;articles&#39;);\n\n        \u002F\u002F Loop through articles, adding an index for each one.\t\t\n        foreach ($query-&gt;result() as $article)\n        {\n            \u002F\u002F Create Lucene document for this article.\n            $doc = new Zend_Search_Lucene_Document();\n\n            \u002F\u002F Add required fields.\n            $doc-&gt;addField(Zend_Search_Lucene_Field::Text(&#39;title&#39;, $article-&gt;title));\n            $doc-&gt;addField(Zend_Search_Lucene_Field::Text(&#39;subtitle&#39;, $subtitle));\n            $doc-&gt;addField(Zend_Search_Lucene_Field::Text(&#39;category&#39;, $category_list));\n            $doc-&gt;addField(Zend_Search_Lucene_Field::Text(&#39;path&#39;, &#39;\u002Farticle\u002Fdisplay\u002F&#39; . $article-&gt;path));\n            $doc-&gt;addField(Zend_Search_Lucene_Field::UnStored(&#39;content&#39;, $article-&gt;summary . $article-&gt;text));\n\n            \u002F\u002F Add docuument to index.\n            $index-&gt;addDocument($doc);\n\n            echo &#39;Added &#39; . $item-&gt;title . &#39; to index.&lt;br \u002F&gt;&#39;;\n        }\n\n        $index-&gt;optimize();\n    }\n\n    function optimize()\n    {\n        $index = Zend_Search_Lucene::open($this-&gt;search_index);\n        $index-&gt;optimize();\n\n        echo &#39;&lt;p&gt;Index optimized.&lt;\u002Fp&gt;&#39;;\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003ETo utilise the index a result method is required:\u003C\u002Fp\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003Efunction result()\n{\n    \u002F\u002F Create empty array, in case there are no results.\n    $data[&#39;results&#39;] = array();\n\n    \u002F\u002F If a search_query parameter has been posted, search the index.\n    if ($this-&gt;input-&gt;post(&#39;search_query&#39;))\n    {\n        $index = Zend_Search_Lucene::open($this-&gt;search_index);\n\n        \u002F\u002F Get results.\n        $data[&#39;results&#39;] = $index-&gt;find($this-&gt;input-&gt;post(&#39;search_query&#39;));\n    }\n\n    \u002F\u002F Load view, and populate with results.\n    $this-&gt;load-&gt;view(&#39;search_result_view&#39;, $data);\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EAnd, of course, a view is required to display the results:\u003C\u002Fp\u003E\n\u003Cpre class=\"language-text\"\u003E\u003Ccode class=\"language-text\"\u003E&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Search results&lt;\u002Ftitle&gt;\n&lt;\u002Fhead&gt;\n&lt;body&gt;\t\t\n\n&lt;h1&gt;Search results&lt;\u002Fh1&gt;\n\n&lt;?php if (empty($_POST[&#39;search_query&#39;])):?&gt;\n&lt;p&gt;No search query submitted.&lt;\u002Fp&gt;\n&lt;?php else:?&gt;\n    &lt;?php if (count($results)):?&gt;\n&lt;p&gt;&lt;?php echo count($results) ?&gt; result(s) returned for query: &lt;?php echo $_POST[&#39;search_query&#39;];?&gt;&lt;\u002Fp&gt;\n&lt;ul&gt;\n    &lt;?php foreach($results as $result):?&gt;\n    &lt;li&gt;&lt;?=anchor(site_url($result-&gt;path), $result-&gt;title);?&gt; (&lt;?php echo round($result-&gt;score, 2) * 100;?&gt;%)&lt;\u002Fli&gt;\n    &lt;?php endforeach;?&gt;\n&lt;\u002Ful&gt;\n    &lt;?php else:?&gt;\n&lt;p&gt;No results were returned for query: &lt;?php echo $_POST[&#39;search_query&#39;];?&gt;&lt;\u002Fp&gt;\n    &lt;?php endif;?&gt;\n&lt;?php endif;?&gt;\n\n&lt;\u002Fbody&gt;\n&lt;\u002Fhtml&gt;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n","cover_image":null}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.261c0a70.js" defer></script><script src="/assets/js/page--src--templates--post-vue.8ad119a0.js" defer></script>
  </body>
</html>